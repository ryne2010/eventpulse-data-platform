# EventPulse Edge Agent (Raspberry Pi) — environment file
#
# Install location (default):
#   /etc/eventpulse-edge/edge.env
#
# IMPORTANT:
# - Keep this file readable only by root (contains secrets).
# - The edge agent will persist the provisioned device token to the spool directory.

# Where the device sends telemetry (Cloud Run service URL)
EDGE_API_BASE_URL=https://YOUR_CLOUD_RUN_URL

# Optional: set a stable device ID.
# If omitted, the agent will derive one from the Pi serial/host.
# EDGE_DEVICE_ID=rpi-001

# Optional: human-friendly label stored in the device registry.
# EDGE_DEVICE_LABEL=Field sensor — North Gate

# Dataset to ingest into (must be allowed server-side via EDGE_ALLOWED_DATASETS)
EDGE_DATASET=edge_telemetry
EDGE_SOURCE=edge_agent

# Recommended: signed URL uploads (device PUTs to GCS, then finalizes ingestion)
EDGE_UPLOAD_MODE=signed_url

# Edge agent image and pull policy.
#
# - If you load images via `docker load` (airgapped / no registry), keep pull policy as "missing".
# - If you publish images to a registry and want auto-pull on restart, set to "always".
#
# EDGE_AGENT_IMAGE=eventpulse-edge-agent:latest
EDGE_AGENT_PULL_POLICY=missing

# Fast provisioning option (recommended): bootstrap enrollment.
# This allows a freshly flashed device to obtain its own per-device token.
EDGE_ENROLL_TOKEN=PASTE_EDGE_ENROLL_TOKEN

# Optional: manually provision a device token (skip enrollment).
# EDGE_DEVICE_TOKEN=PASTE_DEVICE_TOKEN

# Spool directory *inside the container*.
# The systemd unit mounts /var/lib/eventpulse-edge/spool -> /data/spool by default.
EDGE_SPOOL_DIR=/data/spool

# Sensor mode:
# - simulated: generates synthetic telemetry (demo)
# - stdin: reads readings from stdin (JSON, CSV, or float)
# - script: runs EDGE_SENSOR_SCRIPT and parses its output (JSON, CSV, or float)
EDGE_SENSOR_MODE=simulated
# EDGE_SENSOR_SCRIPT=/usr/local/bin/read_sensor.sh
# EDGE_SENSOR_SCRIPT_SHELL=false

# Optional enrichment (nice for UI):
# EDGE_FIRMWARE_VERSION=edge-agent/0.3.5
# EDGE_LAT=39.7392
# EDGE_LON=-104.9903
# EDGE_BATTERY_V=3.95
# EDGE_RSSI_DBM=-85

# Optional docker passthrough for hardware:
# EDGE_DOCKER_DEVICES="/dev/i2c-1,/dev/video0"
# EDGE_DOCKER_GROUP_ADD="998"
# EDGE_DOCKER_RUN_AS_ROOT="true"

# Performance / safety knobs
EDGE_SAMPLE_HZ=2.0
EDGE_HEARTBEAT_SECONDS=30
EDGE_UPLOAD_INTERVAL_SECONDS=10
EDGE_MAX_SPOOL_MB=256
EDGE_MAX_SPOOL_FILES=2000
EDGE_MAX_RETRIES_PER_FILE=12
EDGE_REQUEST_TIMEOUT_SECONDS=30
